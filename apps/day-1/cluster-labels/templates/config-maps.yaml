{{ range $cluster, $data := .Values.clusters }}
---
  {{ $prefixedClusterLabels := dict }}
  {{ range $label, $value := $data.labels }}
    {{ if (eq $value "") }}
      {{ $_ := set $prefixedClusterLabels (printf "%s%s" $.Values.autoshiftLabelPrefix $label)  "_" }}
    {{ else }}
      {{ $_ := set $prefixedClusterLabels (printf "%s%s" $.Values.autoshiftLabelPrefix $label) $value }}
    {{ else }}
  {{ end }}
  {{ $_ := set $data "labels" $prefixedClusterLabels}}
apiVersion: v1
kind: ConfigMap
metadata: 
  name: "{{ printf "managed-cluster.%s" $cluster }}"
  namespace: "open-cluster-policies" 
data: 
  values: '{{ $data | toJson }}'
  labels: '{{ $prefixedClusterLabels | toJson }}'
{{ end }}
{{ range $clusterSet, $data := .Values.clusterSets }}
---
  {{ $prefixedClusterSetLabels := dict }}
  {{ range $label, $value := $data.labels }}
    {{ if (eq $value "") }}
      {{ $_ := set $prefixedClusterSetLabels (printf "%s%s" $.Values.autoshiftLabelPrefix $label)  "_" }}
    {{ else }}
      {{ $_ := set $prefixedClusterSetLabels (printf "%s%s" $.Values.autoshiftLabelPrefix $label) $value }}
    {{ else }}
  {{ end }}
  {{ $_ := set $data "labels" $prefixedClusterSetLabels}}
apiVersion: v1
kind: ConfigMap
metadata: 
  name: {{ printf "cluster-set.%s" $clusterSet }}
  namespace: "open-cluster-policies" 
data:
  values: '{{ $data | toJson }}'
  labels: '{{ $prefixedClusterSetLabels | toJson }}'
{{ end }}